@model IEnumerable<DocuPath.DataLayer.SERVICE_REQUEST>
@using DocuPath.Models;
@{ ViewBag.Title = "Update"; ViewBag.GenericHAPTICLocator = "UpdateGeneric"; ViewBag.SpecificHAPTICLocator = "UpdateFCSpecific"; ViewBag.PageInfoLocator = "UpdateFC"; string BreadcrumbText = "Update Forensic Case: " + ViewBag.TargetDR + " (Service Requests)"; }

@* BREADCRUMB NAVIGATION: *@
<ol class="breadcrumb">
    <li>@Html.ActionLink("Home", "Index", "Home") </li>
    <li>@Html.ActionLink("Forensic Cases", "All", "ForensicCase") </li>
    <li class="active">@Html.ActionLink(BreadcrumbText, "ForensicCaseServiceRequests") </li>
</ol>
@* PAGE HEADER & ACTION BUTTONS: *@
<div class="grid hdr-grid">
    <div class="page-hdr">
        <div class="page-header-subgrid">
            <div class="icon-circle mdl2icon mdl2-fc"></div>
            <div class="circular-motif-left"><img src="~/Content/Resources/CircularMotifLeft.png" style="max-height: 45px" /></div>
            <div class="page-header-text">UPDATE FORENSIC CASE <span style="color: #666">– </span><span style="color: #ae1f1f">SERVICE REQUESTS</span></div>
        </div>
    </div>
    <div class="page-btns">
        <div class="page-buttons-subgrid buttons-seven">
            <div grid-area="left"><img src="~/Content/Resources/CircuitryMotifLeft.png" class="circuitry-left-motif" /></div>
            <div></div>
            <div grid-area="btn1">
                <form id="backForm" class="minimalform" action="~/ForensicCase/ForensicCaseUpdateHub/@ViewBag.TargetID" style="margin-top: 2px">
                    <button id="btnHub" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-hub btn-mdl2icon" type="submit" data-toggle="tooltip" title="BACK TO UPDATE HUB"></button>
                </form>
            </div>
            <div grid-area="btn2">
                <form id="backForm" class="minimalform" action="~/ForensicCase/ProvideSpecimens/@ViewBag.TargetID" style="margin-top: 2px">
                    <button id="btnAdd" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-add btn-mdl2icon" type="submit" data-toggle="tooltip" title="ADD SERVICE REQUEST"></button>
                </form>
            </div>
            <div grid-area="btn3">
                <form class="minimalform" action="@Url.Action("ForensicCaseMediaItems","ForensicCase",new { id=ViewBag.TargetID})" method="post" style="margin-top: 2px">
                    <button id="btnNext" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-forwardnext btn-mdl2icon" type="submit" data-toggle="tooltip" title="NEXT SECTION"></button>
                </form>
            </div>
            <div grid-area="btn4">
                <img src="~/Content/Resources/SlantedDivider.png" style="height: 45px; margin-top: 3px" />
            </div>
            <div grid-area="btn5">
                <form class="minimalform" action="javascript:void(0)" style="margin-top: 2px">
                    <button id="btnDensityToggle" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-density btn-mdl2icon" onclick="this.blur()" data-toggle="tooltip" title="TOGGLE TABLE DENSITY"></button>
                </form>
            </div>
            <div grid-area="btn6">
                <img src="~/Content/Resources/SlantedDivider.png" style="height: 45px; margin-top: 3px" />
            </div>
            <div grid-area="btn7">
                <form class="minimalform" action="javascript:void(0)" style="margin-top: 2px">
                    <button id="btnHapticToggle" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-help btn-mdl2icon" onclick="this.blur();" data-toggle="tooltip" title="HELP"></button>
                </form>
            </div>
            <div></div>
            <div class="right-motif" grid-area="right"><img src="~/Content/Resources/CircuitryMotifRight.png" class="circuitry-right-motif" /></div>
        </div>
    </div>
</div>
@* MODAL NOTIFICATIONS: *@
<div id="divCancelWarning" class="modal-background hidden">
    <div class="modalbox">
        @* TITLE *@
        <div class="modalbox-title-warning"><img class="modalbox-title-mdl2icon" src="~/Content/Resources/icoWarn.png" />WARNING</div>
        @* MESSAGE *@
        <div class="modalbox-message-text">
            Are you sure you want to leave this page? Any unsaved changes will be lost.
        </div>
        @* HELP/INFO *@
        <div class="panel-group" id="warninghelpaccordion">
            <div class="modal-help-panel">
                <div class="panel-heading modalbox-help-panel-heading" data-toggle="collapse" data-target="#warninghelpbody" data-parent="#warninghelpaccordion">More Information</div>
                <div id="warninghelpbody" class="panel-collapse collapse modalbox-help-panel-text">
                    <p style="margin-bottom: 0px; font-weight: bold">Code: W001</p>
                    <hr class="modal-help-hr-warning" />
                    <ul class="haptic-ul">
                        <li>This page allows the user to manipulate information.</li>
                        <li>If any data has been added/changed/amended, navigating away from this page will result in a loss of modified data.</li>
                        <li class="colour-dpred">Please make sure that navigation away from this page is the desired action.</li>
                        <li>To prevent data loss and remain on the current page, click the <kbd>No</kbd> button.</li>
                        <li>To cancel changes and return to the previous page, click the <kbd>Yes</kbd> button.</li>
                    </ul>
                </div>
            </div>
        </div>
        @* BUTTONS *@
        <div class="modalbox-button-bar">
            <div class="col-md-3 modal-btn-col"></div><div class="col-md-3 modal-btn-col"></div>
            <div class="col-md-3 modal-btn-col"></div>
            <div class="col-md-3 modal-btn-col">
                <input type="button" id="btnCancelYes" value="Yes" class="btn btn-modal-generic" onclick="window.location.href(@Url.Action("All","ForensicCase"))" />
                <input type="button" id="btnCancelNo" value="No" class="btn btn-modal-generic" />
            </div>
        </div>
    </div>
</div>

@* PAGE CONTENT: *@
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "validation-text text-danger" })

    <div class="form-horizontal border-generic form-generic">
        <ul class="nav nav-tabs nav-justified" data-toggle="tooltip" title="CASE BUILDER FLOW" data-placement="left">
            <li>                <a class="dynamic-tab-heading" href="~/ForensicCase/UpdateCoreData/@ViewBag.TargetID">Core Data</a></li>
            <li>                <a class="dynamic-tab-heading" href="~/ForensicCase/UpdateObservations/@ViewBag.TargetID" style="margin-left: 5px">Observations</a></li>
            <li class="active"> <a class="dynamic-tab-heading" href="~/ForensicCase/ForensicCaseServiceRequests/@ViewBag.TargetID" style="margin-left: 5px">Service Requests</a></li>
            <li>                <a class="dynamic-tab-heading" href="~/ForensicCase/ForensicCaseMediaItems/@ViewBag.TargetID" style="margin-left: 5px">Media Items</a></li>
            <li>                <a class="dynamic-tab-heading" href="~/ForensicCase/ForensicCaseAdditionalEvidenceItems/@ViewBag.TargetID" style="margin-left: 5px">Additional Evidence</a></li>
            <li>                <a class="dynamic-tab-heading" href="~/ForensicCase/UpdateCauseOfDeath/@ViewBag.TargetID" style="margin-left: 5px">Cause of Death</a></li>
            <li>                <a class="dynamic-tab-heading" href="~/ForensicCase/UpdateStatistics/@ViewBag.TargetID" style="margin-left: 5px">Statistics</a></li>
        </ul>

        <p class="alert-bar alert-bar-neutral fullwidth" style="margin: 5px 0 7.5px 0; text-align: left">Currently showing all <span class="table-large-identifier-alertbar">SERVICE REQUESTS</span> for <span class="table-large-identifier-alertbar">@ViewBag.TargetDR</span>:</p>

        <form class="navbar-form" action="javascript:void(0)" style="border-top: 1px solid rgba(174,31,31,1); border-bottom: 1px solid rgba(174,31,31,1); margin: 0 0 5px 0; padding: 15px">
            <input id="FCSRSearchBar" type="text" class="form-control" onfocus="this.select()" onclick="this.select()" onmouseup="return false;" placeholder="Enter a keyword/phrase..." style="margin: 7.5px 0 15px 0">
        </form>

        <table id="FCSR" class="table table-striped table-hover">
            <tr id="headerRow" style="border-bottom: 1.5px solid #ae1f1f">
                <th class="colour-dpred">Service Provider</th>
                <th class="colour-dpred">Request Type</th>
                <th class="colour-dpred">Raw Serial/Seal Number</th>
                <th class="colour-dpred">Request Note</th>
                <th class="colour-dpred">Date Added</th>
                <th class="colour-dpred">Actions</th>
            </tr>
            @foreach (var item in Model.OrderByDescending(x => x.DateAdded))
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.SERVICE_PROVIDER.CompanyName)</td>
                    <td>@Html.DisplayFor(modelItem => item.REQUEST_TYPE.RequestTypeValue)</td>
                    <td class="table-large-identifier">@Html.DisplayFor(modelItem => item.SPECIMEN.FirstOrDefault().SpecimenSerialNumber)</td>
                    <td><p style="max-width: 350px !important; margin: 0 !important; text-align: justify">@item.RequestNote</p></td>
                    <td>@Html.DisplayFor(modelItem => item.DateAdded)</td>
                    <td>
                        <span data-toggle="tooltip" title="VIEW" data-placement="right"><a class="mdl2icon mdl2-view colour-dpblack" href="javascript:void(0)" onclick="this.blur()" data-toggle="modal" data-target="#SR_@item.ServiceRequestID"></a></span>
                        <div class="modal fade" id="SR_@item.ServiceRequestID" role="dialog">
                            <div class="modal-dialog" style="width:1200px;height:auto;max-height:600px;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div class="grid hdr-grid">
                                            <div class="page-hdr">
                                                <div class="page-header-subgrid">
                                                    <div class="icon-circle mdl2icon mdl2-servicerequest"></div>
                                                    <div class="circular-motif-left"><img src="~/Content/Resources/CircularMotifLeft.png" style="max-height: 45px" /></div>
                                                    <div class="page-header-text">VIEW SERVICE REQUEST</div>
                                                </div>
                                            </div>
                                            <div class="page-btns">
                                                <div class="page-buttons-subgrid buttons-one">
                                                    <div grid-area="left"><img src="~/Content/Resources/CircuitryMotifLeft.png" class="circuitry-left-motif" /></div>
                                                    <div></div>
                                                    <div grid-area="btn1">
                                                        <form class="minimalform" action="javascript:void(0)">
                                                            <button class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-cancel btn-mdl2icon" onclick="this.blur()" data-dismiss="modal" type="submit" data-toggle="tooltip" title="CLOSE" data-placement="right"></button>
                                                        </form>
                                                    </div>
                                                    <div></div>
                                                    <div class="right-motif" grid-area="right"><img src="~/Content/Resources/CircuitryMotifRight.png" class="circuitry-right-motif" /></div>
                                                </div>
                                            </div>
                                        </div>
                                        @*<button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">VIEW SERVICE REQUEST</h4>*@
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-horizontal border-generic form-generic nomarg">
                                            <div class="row" style="margin-left: 0px">
                                                <div class="col-md-12" style="padding-left: 0px; padding-right: 15px">
                                                    <div class="panel-group">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <span class="mdl2icon mdl2-servicerequest panel-mdl2icon"></span>
                                                                <span>SERVICE REQUEST DETAILS</span>
                                                            </div>
                                                            <div class="panel-body">
                                                                <dl class="dl-horizontal-small">
                                                                    <dt>
                                                                        @Html.DisplayName("Company Name")
                                                                    </dt>

                                                                    <dd>
                                                                        @Html.DisplayFor(model => item.SERVICE_PROVIDER.CompanyName)
                                                                    </dd>


                                                                    <dt style="padding-top: 5.2px">
                                                                        @Html.DisplayName("Related Case")
                                                                    </dt>

                                                                    <dd class="large-identifier">
                                                                        @Html.DisplayFor(model => item.FORENSIC_CASE.ForensicDRNumber)
                                                                    </dd>
                                                                    <hr class="details-hr" />
                                                                    <dt>
                                                                        @Html.DisplayName("Request Type")
                                                                    </dt>

                                                                    <dd>
                                                                        @Html.DisplayFor(model => item.REQUEST_TYPE.RequestTypeValue)
                                                                    </dd>

                                                                    <dt>
                                                                        @Html.DisplayName("Request Note")
                                                                    </dt>

                                                                    <dd>
                                                                        @Html.DisplayFor(model => item.RequestNote)
                                                                    </dd>
                                                                    <hr class="details-hr" />
                                                                    <dt>
                                                                        @Html.DisplayName("Date Added")
                                                                    </dt>

                                                                    <dd>
                                                                        @Html.DisplayFor(model => item.DateAdded)
                                                                    </dd>

                                                                    <dt>
                                                                        @Html.DisplayName("Status")
                                                                    </dt>
                                                                    @if (item.IsCancelled == true)
                                                                    {
                                                                        <dd class="status-inactive">Cancelled</dd>
                                                                    }
                                                                    else if (item.SPECIMEN.FirstOrDefault().EXTERNAL_REPORT == null)
                                                                    {
                                                                        <dd class="status-danger">Active</dd>
                                                                    }
                                                                    else if (item.SPECIMEN.FirstOrDefault().EXTERNAL_REPORT != null)
                                                                    {
                                                                        <dd class="status-ok">Closed - External Report Available @Html.Raw("<a class=\"mdl2icon colour-dpblack\" data-toggle=\"tooltip\" value=\"View\" href=\"/ServiceRequest/ViewExternalReport/" + item.SPECIMEN.FirstOrDefault().ExternalReportID + "\"><i class=\"mdl2-view\" style=\"font-style: normal\"></i></a>")</dd>
                                                                    }
                                                                </dl>
                                                            </div>
                                                        </div>
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <span class="mdl2icon mdl2-specimen panel-mdl2icon"></span>
                                                                <span>SPECIMEN DETAILS</span>
                                                            </div>
                                                            <div class="panel-body">
                                                                <dl class="dl-horizontal-small">
                                                                    <dt>@Html.DisplayName("Investigation Required")</dt>
                                                                    <dd>@Html.DisplayFor(model => item.SPECIMEN.FirstOrDefault().InvestigationRequired)</dd>

                                                                    <dt>@Html.DisplayName("Nature/Description")</dt>
                                                                    <dd>@Html.DisplayFor(model => item.SPECIMEN.FirstOrDefault().SpecimenNature)</dd>
                                                                    <hr class="details-hr" />
                                                                    <dt style="padding-top: 5.2px">@Html.DisplayName("Serial/Seal Number")</dt>
                                                                    <dd class="large-identifier">
                                                                        @VERTEBRAE.ChunkString(item.SPECIMEN.FirstOrDefault().SpecimenSerialNumber, 5, " ")
                                                                        @*@Html.DisplayFor(model => model.SPECIMEN.FirstOrDefault().SpecimenSerialNumber)*@
                                                                    </dd>

                                                                    <dt>@Html.DisplayName("Chain Of Custody")</dt>
                                                                    <dd>@Html.DisplayFor(model => item.SPECIMEN.FirstOrDefault().DisposalMechanism)</dd>
                                                                </dl>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        @*<iframe class="frame1" src="~/@VERTEBRAE.GetUrl(item.LegacyDocumentLocation)"></iframe>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </table>
        <p id="noitems" class="alert-bar alert-bar-noitems fullwidth hidden">NO RESULTS FOUND!</p>
    </div>
}

@section Scripts{
@Scripts.Render("~/bundles/bootgrid")
@Scripts.Render("~/bundles/moment")
@Scripts.Render("~/bundles/mark")
@Scripts.Render("~/bundles/materialdatetime")

    <script type="text/javascript">
        //var grid = $("#allSR").bootgrid({
        //    caseSensitive: false,
        //    converters: {
        //        dpdate: {
        //            from: function (value) { return moment(value); },
        //            to: function (value) { return value.format("ddd D MMM YYYY"); }
        //        }
        //    },
        //    formatters: {
        //        // INSERTS APPROPRIATE ACTION BUTTONS FOR EACH LINE IN THE ASPTABLE:
        //        "commands": function (column, row) {
        //            if (row.status.trim() == "Closed") {
        //                return "<a class=\"mdl2icon colour-dpblack\" href=\"/ServiceRequest/Details/" + row.SRID.trim() + "\"><i class=\"mdl2-view\" data-toggle=\"tooltip\" title=\"View\" data-placement=\"right\" style=\"font-style: normal\"></i></a>";
        //            } else if (row.status.trim() == "Active") {
        //                return "<a class=\"mdl2icon colour-dpblack\" href=\"/ServiceRequest/Details/" + row.SRID.trim() + "\"><i class=\"mdl2-view\" data-toggle=\"tooltip\" title=\"View\" data-placement=\"right\" style=\"font-style: normal\"></i></a>" +
        //                    "<a class=\"mdl2icon colour-dpblack\" data-toggle=\"tooltip\" title=\"Cancel\" data-placement=\"right\" href=\"/ServiceRequest/Cancel/" + row.SRID.trim() + "\"><i class=\"mdl2-cancel\" style=\"font-style: normal\"></i></a>" +
        //                    "<a class=\"mdl2icon colour-dpblack\" data-toggle=\"tooltip\" title=\"Link\" data-placement=\"right\" href=\"/ServiceRequest/LinkExternalReport/" + row.SRID.trim() + "\"><i class=\"mdl2-link\" style=\"font-style: normal\"></i></a>";
        //            }
        //        },
        //        "drnumbers": function (column, row) { /* APPLY LARGE IDENTIFIER CLASS TO ALL DR NUMBERS: */
        //            return "<span class=\"table-large-identifier\">" + row.FCDR + "</span>";
        //        }
        //    }
        //});
    </script>
    <script id="onDomReady" type="text/javascript">
            // Enable tooltips:
            $(document).ready(function () {
                $('[data-toggle="tooltip"]').tooltip();
            });

            // Toggle Table Density:
            $("#btnDensityToggle").click(function () {
                var $target = $("#allSR");
                var $condensed = "table-condensed";
                var $minimal = "table-minimal"
                if ($target.hasClass($condensed) === false && $target.hasClass($minimal) === false) { $target.addClass($condensed); }
                else if ($target.hasClass($condensed)) { $target.removeClass($condensed); $target.addClass($minimal); }
                else if ($target.hasClass($minimal)) { $target.removeClass($minimal); }
                $("#btnDensityToggle").blur()
            });

            // FILTER ON TYPING:
            var $rows = $('#FCSR tr:not(#headerRow)');
            $('#FCSRSearchBar').keyup(function() {
                var query = '^(?=.*\\b' + $.trim($(this).val()).split(/\s+/).join('\\b)(?=.*\\b') + ').*$',
                    reg = RegExp(query, 'i'),
                    text;
                $rows.show().filter(function() {
                    text = $(this).text().replace(/\s+/g, ' ');
                    return !reg.test(text);
                }).hide();
            });
    </script>
}