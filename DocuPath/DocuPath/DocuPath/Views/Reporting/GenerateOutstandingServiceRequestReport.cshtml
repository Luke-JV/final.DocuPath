@model DocuPath.Models.DPViewModels.InsightOSRDataset
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.js"></script>

@{ ViewBag.Title = "Live Report Preview"; ViewBag.GenericHAPTICLocator = "LiveReportGeneric"; ViewBag.SpecificHAPTICLocator = "LiveReportSpecific"; ViewBag.PageInfoLocator = "LiveReport"; }

@* PAGE HEADER & ACTION BUTTONS: *@
<div class="grid hdr-grid" style="margin-top: 10px">
    <div class="page-hdr">
        <div class="page-header-subgrid">
            <div class="icon-circle mdl2icon mdl2-reporting"></div>
            <div class="circular-motif-left"><img src="~/Content/Resources/CircularMotifLeft.png" style="max-height: 45px" /></div>
            <div class="page-header-text">LIVE REPORT PREVIEW <span style="color: #666">– </span><span style="color: #ae1f1f">OUTSTANDING SERVICE REQUEST REPORT</span></div>
        </div>
    </div>
    <div class="page-btns">
        <div class="page-buttons-subgrid buttons-three">
            <div grid-area="left"><img src="~/Content/Resources/CircuitryMotifLeft.png" class="circuitry-left-motif" /></div>
            <div></div>
            <div grid-area="btn1">
                <form class="minimalform" @*action="~/GenerateCauseOfDeathReport" method="post"*@ style="margin-top: 2px">
                    <button id="btnPrint" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-print btn-mdl2icon" type="button" data-toggle="tooltip" title="PRINT"></button>
                </form>
            </div>
            <div grid-area="btn2">
                <img src="~/Content/Resources/SlantedDivider.png" style="height: 45px; margin-top: 3px" />
            </div>
            <div grid-area="btn3">
                <form class="minimalform" action="javascript:void(0)" style="margin-top: 2px">
                    <button id="btnHapticToggle" class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-help btn-mdl2icon" onclick="this.blur()" data-toggle="tooltip" title="HELP"></button>
                </form>
            </div>
            <div></div>
            <div class="right-motif" grid-area="right"><img src="~/Content/Resources/CircuitryMotifRight.png" class="circuitry-right-motif" /></div>
        </div>
    </div>
</div>

<div id="reportPreview" class="form-horizontal form-generic">
    <div class="grid reportcontainer border-generic form-horizontal" style="width: 760px !important; padding: 5px 5px 5px 10px">
        <img class="dplogo" src="~/Content/Resources/DPHorizontalLogoWhiteBG.png" style="max-height: 50px; max-width: 150px" />
        <img class="separator1" src="~/Content/Resources/SlantedDivider.png" style="max-height: 50px" />
        <div class="grid report-timestamp">
            <span class="stamp-icon insight-mdl2icon mdl2-action"></span>
            <div class="stamp-label">TIMESTAMP</div>
            <div class="stamp-value">@DateTime.Now.ToString("dd MMM yyyy HH:mm:ss")</div>
            <div class="stamp-icon insight-mdl2icon mdl2-datetime"></div>
            <div class="stamp-label">TIMEFRAME</div>
            <div class="stamp-value">@Model.dsTimeframeToString</div>
        </div>
        <img class="separator2" src="~/Content/Resources/SlantedDivider.png" style="max-height: 50px" />
        <div class="grid report-generator">
            <div class="generator-label">GENERATED BY</div>
            <span class="generator-icon insight-mdl2icon mdl2-individual"></span>
            <div class="generator-value">@Model.dsGeneratedBy</div>
        </div>
        <img class="insightlogo" src="~/Content/Resources/DP_INSIGHT_FINALLOGO_TRANSPARENTBG.png" style="max-height: 50px; max-width: 150px" />
        <div class="report-title">OUTSTANDING SERVICE REQUEST REPORT</div>
        <div class="grid report-params-summary-container">
            <div class="grid params-grid">
                <div class="params-icon insight-mdl2icon mdl2-count"></div>
                <div class="params-label">NUMBER OF ENTRIES</div>
                <div class="params-value">@Model.dsNumEntries</div>
                <div class="params-icon insight-mdl2icon mdl2-param"></div>
                <div class="params-label">SORTED BY</div>
                <div class="params-value">@Model.dsSortedBy</div>
                <div class="params-icon insight-mdl2icon mdl2-param"></div>
                <div class="params-label">GROUPED BY</div>
                <div class="params-value">@Model.dsGroupedBy</div>
            </div>
            <div class="vsep"></div>
            <div class="grid summary-grid">
                <div class="summary-icon insight-mdl2icon mdl2-info"></div>
                <div class="summary-label">REPORT SUMMARY</div>
                <div class="summary-value">This report contains information relating to outstanding Service Requests within the specified timeframe, including the number of days the Request has been open, the Service Provider it was issued to, the Forensic Case it relates to, and the User responsible for adding it onto the system.</div>
            </div>
        </div>
        <div class="report-content">
            <table id="OSR" class="table table-striped table-hover table-condensed table-insight">
                <thead>
                    <tr>
                        <th @*data-id="identifier" data-column-id="FCID" data-visible="false" data-identifier="true"*@ class="colour-dpred">
                            ID
                        </th>
                        <th @*data-column-id="addedBy"*@ class="colour-dpred">
                            Service Provider Company Name
                        </th>
                        <th @*data-column-id="status"*@ class="colour-dpred">
                            Related Forensic Case
                        </th>
                        <th @*data-column-id="FCDR" data-cssClass="table-large-identifier-insight-insight" data-formatter="drnumbers"*@ class="colour-dpred">
                            Added By
                        </th>
                        <th class="colour-dpred">
                            Date Added
                        </th>
                        <th class="colour-dpred">
                            Days Open
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.dsOSR.Count; i++)
                    {
                        <tr>
                            <td>
                                @Model.dsOSR[i].SRid
                            </td>
                            <td>
                                @Model.dsOSR[i].SPCompanyName
                            </td>
                            <td>
                                <strong class="table-large-identifier">@Model.dsOSR[i].DRNum</strong>
                            </td>
                            <td>
                                @Model.dsOSR[i].SRAddedBy
                            </td>
                            <td>
                                @Model.dsOSR[i].DateAdded
                            </td>
                            <td>
                                <strong class="table-large-identifier">@Model.dsOSR[i].DaysOpen</strong>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @*<div class="grid insight-chart-grid" style="margin-top: 5px">
                    <span class="chart-icon insight-mdl2icon mdl2-chart"></span>
                    <div class="chart-title">CAUSE OF DEATH BREAKDOWN - TOP 5 CONTRIBUTORS</div>
                    <div class="chart-subtitle">@Model.dsTimeframeToString</div>
                    <canvas class="chart-area" id="CODcanvas" width="750" height="500"></canvas>
                </div>*@
        </div>
        <div class="grid report-footer footer-bg">
            <div class="page-counter" style="margin-left: 80px">DocuPath INSIGHT REPORTING ENGINE</div>
            <div class="page-counter"><<<span class="page-counter-accent"> END </span>>></div>
        </div>
    </div>
</div>
@*<div class="modal fade" id="report_gen" role="dialog">
        <div class="modal-dialog" style="width:800px;height:auto;max-height:600px;min-height:450px">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="grid hdr-grid">
                        <div class="page-hdr">
                            <div class="page-header-subgrid">
                                <div class="icon-circle mdl2icon mdl2-reporting"></div>
                                <div class="circular-motif-left"><img src="~/Content/Resources/CircularMotifLeft.png" style="max-height: 45px" /></div>
                                <div class="page-header-text">GENERATED REPORT PREVIEW</div>
                            </div>
                        </div>
                        <div class="page-btns">
                            <div class="page-buttons-subgrid buttons-two">
                                <div grid-area="left"><img src="~/Content/Resources/CircuitryMotifLeft.png" class="circuitry-left-motif" /></div>
                                <div></div>
                                <div grid-area="btn1">
                                    <form class="minimalform" action="javascript:void(0)" style="margin-top: 2px">
                                        <button class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-cancel btn-mdl2icon" onclick="this.blur()" data-dismiss="modal" type="submit" data-toggle="tooltip" title="CLOSE" data-placement="left"></button>
                                    </form>
                                </div>
                                <div grid-area="btn2">
                                    <form class="minimalform" action="javascript:void(0)" style="margin-top: 2px">
                                        <button class="btn btn-default btn-generic btn-page-action mdl2icon mdl2-print btn-mdl2icon" onclick="this.blur()" type="submit" data-toggle="tooltip" title="PRINT" data-placement="right"></button>
                                    </form>
                                </div>
                                <div></div>
                                <div class="right-motif" grid-area="right"><img src="~/Content/Resources/CircuitryMotifRight.png" class="circuitry-right-motif" /></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal form-generic nomarg">
                        <div id="reportPreview" class="grid reportcontainer">
                            <img class="dplogo" src="~/Content/Resources/DPHorizontalLogoWhiteBG.png" style="max-height: 50px; max-width: 150px" />
                            <img class="separator1" src="~/Content/Resources/SlantedDivider.png" style="max-height: 50px" />
                            <div class="grid report-timestamp">
                                <span class="stamp-icon insight-mdl2icon mdl2-action"></span>
                                <div class="stamp-label">TIMESTAMP</div>
                                <div class="stamp-value">@System.DateTime.Now.ToString("dd MMM yyyy HH:mm:ss")</div>
                                <div class="stamp-icon insight-mdl2icon mdl2-datetime"></div>
                                <div class="stamp-label">TIMEFRAME</div>
                                <div class="stamp-value">@System.DateTime.Now.Date.AddDays(-7).ToString("dd MMM yyyy") - @System.DateTime.Now.Date.ToString("dd MMM yyyy")</div>
                            </div>
                            <img class="separator2" src="~/Content/Resources/SlantedDivider.png" style="max-height: 50px" />
                            <div class="grid report-generator">
                                <div class="generator-label">GENERATED BY</div>
                                <span class="generator-icon insight-mdl2icon mdl2-individual"></span>
                                <div class="generator-value">John Doe</div>
                            </div>
                            <img class="insightlogo" src="~/Content/Resources/DP_INSIGHT_FINALLOGO_TRANSPARENTBG.png" style="max-height: 50px; max-width: 150px" />
                            <div class="report-title">USER ACTIVITY REPORT</div>
                            <div class="grid report-params-summary-container">
                                <div class="grid params-grid">
                                    <div class="params-icon insight-mdl2icon mdl2-count"></div>
                                    <div class="params-label">NUMBER OF ENTRIES</div>
                                    TAKE THIS OUT:
                                    <div class="params-value">@Model.activityTransactions.Count</div>
                                    TO HERE
                                    <div class="params-icon insight-mdl2icon mdl2-param"></div>
                                    <div class="params-label">SORTED BY</div>
                                    <div class="params-value">Timestamp</div>
                                    <div class="params-icon insight-mdl2icon mdl2-param"></div>
                                    <div class="params-label">GROUPED BY</div>
                                    <div class="params-value">None</div>
                                </div>
                                <div class="vsep"></div>
                                <div class="grid summary-grid">
                                    <div class="summary-icon insight-mdl2icon mdl2-info"></div>
                                    <div class="summary-label">REPORT SUMMARY</div>
                                    <div class="summary-value">This report contains user activity information for the selected user during the specified report timeframe.</div>
                                </div>
                            </div>
                            <div class="report-content">
                                <table id="allFC" class="table table-striped table-hover table-condensed table-insight">
                                    <thead>
                                        <tr>
                                            <th data-id="identifier" data-column-id="FCID" data-visible="false" data-identifier="true" class="colour-dpred">
                                                ID
                                            </th>
                                            <th data-column-id="addedBy" class="colour-dpred">
                                                Activity Type
                                            </th>
                                            <th data-column-id="status" class="colour-dpred">
                                                Datestamp
                                            </th>
                                            <th data-column-id="FCDR" data-cssClass="table-large-identifier-insight-insight" data-formatter="drnumbers" class="colour-dpred">
                                                Timestamp
                                            </th>
                                            <th data-column-id="dateAdded" data-converter="dpdate" data-order="desc" class="colour-dpred">
                                                Description
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        TAKE THIS OUT:
                                        @for (int i = 0; i < Model.activityTransactions.Count; i++)
                                            {
                                                <tr>
                                                    <td>
                                                        @Model.activityTransactions[i].AuditLogTxID.ToString()
                                                    </td>
                                                    <td>
                                                        @Model.activityTransactions[i].AUDIT_TX_TYPE.TypeValue
                                                    </td>
                                                    <td>
                                                        @Model.activityTransactions[i].TxDateStamp.ToString("dd MMM yyyy")
                                                    </td>
                                                    <td>
                                                        @Model.activityTransactions[i].TxTimeStamp.ToString("HH:mm:ss")
                                                    </td>
                                                    <td>
                                                        @Model.activityTransactions[i].TxCriticalDataString
                                                    </td>
                                                </tr>
                                            }
                                        TO HERE
                                    </tbody>
                                </table>
                                <div class="grid insight-chart-grid">
                                    <span class="chart-icon insight-mdl2icon mdl2-chart"></span>
                                    <div class="chart-title">USER ACTIVITY FREQUENCY GRAPH</div>
                                    <div class="chart-subtitle"></div>
                                    <canvas class="chart-area" id="myChart" width="500" height="400"></canvas>
                                </div>
                            </div>
                            <div class="grid report-footer footer-bg">
                                <div></div>
                                <div class="page-counter">PAGE 1<span class="page-counter-accent">OF 999</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>*@

@section Scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/toggle")
    @Scripts.Render("~/bundles/materialdatetime")

    <script>
        //Chart Colour Palettes:
        var Green = "#468847";
        var DarkGreen = "#316731";
        var Orange = "#ff7d00";
        var DarkOrange = "#a2601f";
        var Grey = "#999";
        var DarkGrey = "#666";
        var DPRed = "#ae1f1f";
        var DarkRed = "#7b1515";
        var DarkBlue = "#253494";
        var DarkPurple = "#6a10ae";

        var DPRedEighty = "rgba(174, 31, 31, 0.8)";
        var DPRedSixty = "rgba(174, 31, 31, 0.6)";
        var DPRedForty = "rgba(174, 31, 31, 0.4)";
        var DPRedTwenty = "rgba(174, 31, 31, 0.2)";

        var GreyHundred = "rgba(128, 128, 128, 1)";
        var GreyEighty = "rgba(128, 128, 128, 0.8)";
        var GreySixty = "rgba(128, 128, 128, 0.6)";
        var GreyForty = "rgba(128, 128, 128, 0.4)";
        var GreyTwenty = "rgba(128, 128, 128, 0.2)";

        // COD Contribution Doughnut:
        @*var str = @Model.dsChartLabels;
        var res = str.replace(/&#39;/g, "'");*@
        var ctx = document.getElementById("CODcanvas").getContext('2d');
        @*var labels = "'" + @Model.dsChartLabels +"'";
        var labelstrimmed = labels.replace("&#39;","'");*@
        var CODdoughnut = new Chart(ctx, {
            type: 'pie',
            data: [ @Model.dsChartData ],
            labels: [ 'Label1','Label2','Label3','Label4','Label5','Label6' ],
            //data: {
            //    datasets: [
            //        {
            //            //backgroundColor: [DarkGreen, DarkOrange, DarkBlue, DarkRed, DarkPurple, DarkGrey],
            //            //borderColor: GreyHundred,
            //            //borderWidth: 1,
            //        }
            //    ]
            //},
            //options: { cutoutPercentage: 50, aspectRatio: 1 }
        });

        //var myDoughnutChart = new Chart(ctx, {
        //    type: 'doughnut',
        //    data: [1, 2, 3, 4, 10],
        //    labels: ['Test1', 'Test2', 'Test3', 'Test4', 'Test5']
        //    //options: { cutoutPercentage: 50, aspectRatio: 1 }
        //});

//        var ctx = document.getElementById("COD").getContext('2d');
//var myChart = new Chart(ctx, {
//    type: 'bar',
//    data: {
//        labels: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
//        datasets: [{
//            label: 'Relative Frequency',
//            data: [12, 19, 3, 5, 2, 26, 25],
//            backgroundColor: [
//                'rgba(174, 31, 31, 0.2)',
//                'rgba(0, 0, 0, 0.2)',
//                'rgba(128, 128, 128, 0.2)',
//                'rgba(174, 31, 31, 0.2)',
//                'rgba(0, 0, 0, 0.2)',
//                'rgba(128, 128, 128, 0.2)',
//            ],
//            borderColor: [
//                'rgba(174, 31, 31, 1)',
//                'rgba(128, 128, 128, 1)',
//                'rgba(180, 180, 180, 1)',
//                'rgba(174, 31, 31, 1)',
//                'rgba(128, 128, 128, 1)',
//                'rgba(180, 180, 180, 1)',
//            ],
//            borderWidth: 1
//        }]
//    },
//    options: {
//        scales: {
//            yAxes: [{
//                ticks: {
//                    beginAtZero:true
//                }
//            }]
//        }
//    }
//});
    </script>
    <script>
        $('#btnPrint').on('click', function(){
            window.print()
        });
    </script>
}